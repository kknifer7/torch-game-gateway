## core 模块

- **角色介绍**：网关实现代理、鉴权等基础功能的核心角色

- **多协议支持**：支持 HTTP、HTTPS（可配置支持客户端-服务端双向认证）、RPC，其中，理论上支持所有基于 RPC 通信模型的协议（不排除一些特殊协议不适用的情况）

- **路由（服务接口）的挂载与移除**：core 支持两种挂载方式，一种是本地挂载：启动时指定路由 json 文件的路径，core 将读取这些路由设置并挂载为自己的私有路由；另一种是联机推送：在 admin 模块处有详细介绍；另外，在路由条目有变动时，core 会及时断开连接，并删除一系列相关的对象和上下文，当一个 RPC 路由被导入或产生变动时，core 会及时断开原本的连接，并连接新的目标主机，如果连接不成功，core 会定期进行重连，而后续的变更和删除操作也会打断旧路由的重连尝试，使用者可不必担心内存泄漏等问题

- **服务集群与负载均衡**：如果在 core 中配置了服务名称相同的路由，则这些路由指向的不同目标服务将被视为一个服务集群，core 会根据启动设置采用指定的负载均衡算法对其进行负载均衡（为方便测试，负载均衡类默认配置为 NoLoadbalancer，即不进行负载均衡，可以通过修改启动配置来变更策略）

- **实例集群、心跳与负载均衡**：多个 core 实例构成集群，每个实例中都内置有心跳客户端（通过 Netty 自主实现），实例会与 deacon 定期进行心跳通信（通信遵循特殊的自定义协议，core 与 deacon 双方均需要配置认证口令，默认为 123456），由 deacon 对所有实例进行自动监控和管理，一般情况下，deacon 是主要访问入口，deacon 同样会对 core 集群进行负载均衡，其原理与 core 中对服务集群的负载均衡原理一致，默认策略为轮询策略

- **双集群备份与无缝切换**：core 在启动时可以配置是否为备用实例，作为备用实例的 core 在常规情况下不会被 deacon 加入负载均衡列表（也就是不会被启用），用户可以在基础配置中设置“备用集群激活阈值”，默认为 1，意为“当前可用的非备用实例小于等于 1 时，所有备用实例也将被启用”；此过程用户毫无感知，可通过检查 deacon 输出日志加以印证

- **健壮性**：每个 core 实例都是一只“小强”。为了确保极端情况下的网关可用性，core 集群中的任何一个实例都被设计为可以脱离任何角色、环境，自主运行而不失能，core 实例内置保有一份自己的路由信息，并提供有读取接口，因此也具备一定的容灾备份能力。综上，每个 core 实例的地址都可以作为特殊情况下的备用服务地址；如果项目较小，通过使用单个 core 实例也能满足一般的代理需求（尽管我们不推荐这样做）

- **限流与熔断**：core 支持单用户、单接口限流，其中，通过在 admin 控制台添加用户限流器可以指挥实例集群统一对某个用户进行限流，而不会影响到其他用户；接口限流器则默认配置在所有实例下的所有路由，不允许增删，可以通过 admin 端的基础配置进行接口限流参数的统一修改；此外，可以通过配置项开启“限流时熔断”，这样一来，限流器触发限流的同时就对目标接口（路由）配置熔断，这一项默认是开启的；

## deacon 模块

- **角色介绍**：监控、调度、熔断、分析 core 实例集群的重要角色；

- **服务调用情况监控与记录**：core 实例会将自己的每一条调用信息都发送给 deacon，由 deacon 进行相关分析与持久化记录

- **熔断决策**：core 实例在触发限流的同时可以对路由进行熔断，而 deacon 在接收到 core 的调用信息时，会根据它的启动项配置的指定规则的熔断器进行再一次的熔断决策，默认的熔断决策是“在指定单位的指定时间内，路由调用的失败次数到达了指定数目，就单独熔断那个路由”，上述提到的所有配置均可以在 admin 控制台进行设置

- **网关集群监控**：deacon 会从 core 实例定期发来的心跳包中获取 core 网关的域名、端口、各项性能信息等，将其转移到自身内置的线程安全的容器中暂存（core 对于路由信息也是类似的处理方式），如果在指定的时间内（配置启动项可以更改，默认为 10s）连续解析失败或丢失超过 5 次目标 core 实例的心跳包，或者检测到有 core 实例强行断开了心跳连接，则 deacon 会将对应的网关实例信息从集群中移除

## admin 模块与前端项目

- **角色介绍**：是网关使用者的控制台，可以查询到必要信息，以及手动对网关进行配置与变更操作；采取前后端分离，前端项目采用了 Vben Admin 开源项目进行了二次开发，进行过大量的删减，该开源项目地址：https://vvbin.cn/doc-next/

- **动态扩容**：admin 模块可以对路由、服务信息进行更新，产生的新路由、路由变更、路由删除等信息都会推送至 Redis 中的指定频道，利用 Redis 的消息订阅机制，core 一侧会监听到这些信息并完成更改，相关的路由也会被直接挂载生效

- **配置热更新**：admin 前端展示的一切配置均是热更新的，不需要重启项目，请放心、谨慎地更改

- **用户管理**：用户信息的查看与配置

- **集群监控**：集群信息、每个实例限流器列表的查看与配置

- **路由调用信息**：提供详细路由调用信息的查询

- **分析页**：一个简单的数据总览页

- **关于**：就是本页面
